<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="x-apple-disable-message-reformatting">
  <title>Duty Roster</title>
  <style>
    /* â•â•â•â•â•â•â• RESET â•â•â•â•â•â•â• */
    body {
      margin:0; padding:0;
      background:#eef1f7;
      font-family:'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif;
      color:#0f172a;
      -webkit-font-smoothing:antialiased;
    }
    * { box-sizing:border-box; }

    /* â•â•â•â•â•â•â• WRAP â•â•â•â•â•â•â• */
    .wrap { max-width:680px; margin:0 auto; padding:16px 14px 28px; }

    /* â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â• */
    .header {
      background:linear-gradient(135deg, #1e40af 0%, #1976d2 50%, #0ea5e9 100%);
      color:#fff;
      padding:26px 18px 24px;
      border-radius:20px;
      text-align:center;
      box-shadow:0 8px 28px rgba(30,64,175,.25);
      position:relative;
      overflow:hidden;
    }
    .header::before {
      content:''; position:absolute;
      top:-30px; right:-40px;
      width:140px; height:140px;
      border-radius:50%;
      background:rgba(255,255,255,.08);
    }
    .header::after {
      content:''; position:absolute;
      bottom:-50px; left:-30px;
      width:160px; height:160px;
      border-radius:50%;
      background:rgba(255,255,255,.06);
    }
    .header h1 { margin:0; font-size:24px; font-weight:800; position:relative; z-index:1; letter-spacing:-.3px; }
    
    /* â•â•â•â•â•â•â• LANG TOGGLE â•â•â•â•â•â•â• */
    .langToggle {
      position:absolute;
      top:14px;
      left:16px;
      z-index:10;
      background:rgba(255,255,255,.18);
      border:2px solid rgba(255,255,255,.25);
      border-radius:50%;
      width:32px;
      height:32px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-size:13px;
      font-weight:800;
      cursor:pointer;
      transition:all .25s;
      -webkit-tap-highlight-color:transparent;
      padding:0;
    }
    .langToggle:hover {
      background:rgba(255,255,255,.30);
      transform:scale(1.08);
    }
    /* RTL support */
    body.ar { direction:rtl; font-family:'Segoe UI', Tahoma, Arial, sans-serif; }
    body.ar .langToggle { left:auto; right:16px; }
    /* Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ£ÙƒÙˆØ§Ø¯Ù‡Ù… ØªØ¨Ù‚Ù‰ LTR Ø¯Ø§Ø¦Ù…Ø§Ù‹ */
    .empRow, .empName, .empStatus {
      direction:ltr !important;
      unicode-bidi:embed;
      text-align:left !important;
    }

    /* Date Picker Wrapper */
    /* Date Picker */
    .datePickerWrapper {
      margin-top:14px;
      display:inline-block;
      position:relative;
    }
    .header .dateTag {
      display:inline-block;
      background:rgba(255,255,255,.18);
      padding:5px 18px;
      border-radius:10px;
      font-size:13px;
      font-weight:600;
      letter-spacing:.3px;
      cursor:pointer;
      transition:all .3s;
      border:2px solid rgba(255,255,255,.2);
      -webkit-tap-highlight-color:transparent;
      user-select:none;
      -webkit-user-select:none;
    }
    .header .dateTag:hover {
      background:rgba(255,255,255,.25);
      transform:translateY(-1px);
    }
    /* Custom calendar popup */
    .calPopup {
      display:none;
      position:fixed;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      background:#fff;
      border-radius:16px;
      box-shadow:0 20px 60px rgba(0,0,0,.25);
      padding:20px;
      z-index:9999;
      min-width:300px;
      font-family:'Segoe UI',system-ui,sans-serif;
    }
    .calPopup.open { display:block; }
    .calOverlay {
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.4);
      z-index:9998;
    }
    .calOverlay.open { display:block; }
    .calHeader {
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:14px;
    }
    .calHeader button {
      background:none;
      border:none;
      font-size:20px;
      cursor:pointer;
      color:#1e40af;
      padding:4px 10px;
      border-radius:8px;
    }
    .calHeader button:hover { background:#f1f5f9; }
    .calMonthYear {
      font-weight:700;
      font-size:15px;
      color:#0f172a;
    }
    .calGrid {
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:4px;
      text-align:center;
    }
    .calDayName {
      font-size:11px;
      font-weight:700;
      color:#94a3b8;
      padding:4px 0;
    }
    .calDay {
      padding:7px 4px;
      border-radius:8px;
      font-size:13px;
      cursor:pointer;
      color:#0f172a;
      border:none;
      background:none;
    }
    .calDay:hover { background:#dbeafe; color:#1e40af; }
    .calDay.today { background:#1e40af; color:#fff; font-weight:700; }
    .calDay.selected { background:#0ea5e9; color:#fff; font-weight:700; }
    .calDay.other-month { color:#cbd5e1; }
    .calDay:disabled { color:#e2e8f0; cursor:default; }
    .calClose {
      text-align:center;
      margin-top:14px;
    }
    .calClose button {
      background:#f1f5f9;
      border:none;
      padding:8px 24px;
      border-radius:8px;
      cursor:pointer;
      font-size:13px;
      color:#64748b;
    }

    /* â•â•â•â•â•â•â• SUMMARY BAR â•â•â•â•â•â•â• */
    .summaryBar { 
      display:flex; 
      justify-content:center; 
      align-items:stretch;
      gap:12px; 
      margin-top:14px;
      flex-wrap:nowrap; /* Ù…Ù†Ø¹ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙ Ø«Ø§Ù†ÙŠ */
    }
    .summaryChip {
      background:#fff;
      border:1px solid rgba(15,23,42,.1);
      border-radius:14px;
      padding:10px 16px; /* ØªÙ‚Ù„ÙŠÙ„ padding Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      text-align:center;
      box-shadow:0 2px 8px rgba(15,23,42,.06);
      transition:all .25s ease;
      min-width:90px; /* Ø­Ø¯ Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¹Ø±Ø¶ */
    }
    .summaryChip .chipVal { font-size:22px; font-weight:900; color:#1e40af; }
    .summaryChip .chipLabel { 
      font-size:10px; /* Ø®Ø· Ø£ØµØºØ± Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      font-weight:600; 
      color:#64748b; 
      text-transform:uppercase; 
      letter-spacing:.5px; 
      margin-top:2px;
      white-space:nowrap; /* Ù…Ù†Ø¹ Ø§Ù„ÙƒØ³Ø± */
    }

    /* â•â•â•â•â•â•â• SHIFT FILTER BUTTONS AS CHIPS â•â•â•â•â•â•â• */
    button.summaryChip.shiftFilterBtn {
      border:2px solid transparent;
      position:relative;
      overflow:hidden;
      padding:10px 14px; /* padding Ø£ØµØºØ± Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
    }
    button.summaryChip.shiftFilterBtn:hover {
      transform:translateY(-3px);
      box-shadow:0 8px 20px rgba(15,23,42,.12);
    }
    button.summaryChip.shiftFilterBtn.active {
      border-color:currentColor;
      box-shadow:0 6px 16px rgba(15,23,42,.18);
    }
    button.summaryChip.shiftFilterBtn.active::before {
      content:'';
      position:absolute;
      top:0;left:0;right:0;bottom:0;
      background:currentColor;
      opacity:.06;
    }
    
    /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙˆØ±Ø¯ÙŠØ§Øª */
    button.shiftFilterBtn.morning {
      color:#f59e0b;
    }
    button.shiftFilterBtn.morning .chipVal { color:#f59e0b; }
    button.shiftFilterBtn.morning .chipLabel { color:#92400e; }
    
    button.shiftFilterBtn.afternoon {
      color:#f97316;
    }
    button.shiftFilterBtn.afternoon .chipVal { color:#f97316; }
    button.shiftFilterBtn.afternoon .chipLabel { color:#9a3412; }
    
    button.shiftFilterBtn.night {
      color:#8b5cf6;
    }
    button.shiftFilterBtn.night .chipVal { color:#8b5cf6; }
    button.shiftFilterBtn.night .chipLabel { color:#5b21b6; }
    
    button.shiftFilterBtn.all {
      color:#1e40af;
    }
    button.shiftFilterBtn.all .chipVal { color:#1e40af; }
    button.shiftFilterBtn.all .chipLabel { color:#1e40af; }
    
    /* Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© */
    @media (max-width:900px){
      .summaryBar { flex-wrap:wrap; } /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ */
    }
    
    /* Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    @media (max-width:600px){
      .summaryBar { gap:8px; }
      .summaryChip { padding:8px 12px; min-width:70px; }
      .summaryChip .chipVal { font-size:19px; }
      .summaryChip .chipLabel { font-size:9px; }
    }


    /* â•â•â•â•â•â•â• DEPARTMENT CARD â•â•â•â•â•â•â• */
    .deptCard {
      margin-top:18px;
      background:#fff;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(15,23,42,.07);
      box-shadow:0 4px 18px rgba(15,23,42,.08);
    }
    .deptHead {
      display:flex;
      align-items:center;
      gap:12px;
      padding:14px 16px;
      background:#fff;
    }
    .deptIcon {
      width:40px; height:40px;
      border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      flex-shrink:0;
    }
    .deptTitle { font-size:18px; font-weight:800; color:#1e293b; flex:1; letter-spacing:-.2px; }
    .deptBadge { min-width:48px; padding:6px 10px; border-radius:12px; text-align:center; }

    /* â•â•â•â•â•â•â• SHIFT STACK â•â•â•â•â•â•â• */
    .shiftStack { padding:10px; display:flex; flex-direction:column; gap:8px; }

    /* â•â•â•â•â•â•â• SHIFT CARD â€” <details> â•â•â•â•â•â•â• */
    .shiftCard {
      border-radius:14px;
      overflow:hidden;
    }

    .shiftSummary {
      display:flex;
      align-items:center;
      gap:10px;
      padding:11px 14px;
      cursor:pointer;
      list-style:none;
      -webkit-appearance:none;
      appearance:none;
      user-select:none;
    }
    .shiftSummary::-webkit-details-marker { display:none; }
    .shiftSummary::marker              { display:none; }

    .shiftIcon  { font-size:20px; line-height:1; flex-shrink:0; }
    .shiftLabel { font-size:15px; font-weight:800; flex:1; letter-spacing:-.1px; }
    .shiftCount {
      font-size:13px; font-weight:800;
      padding:3px 10px; border-radius:20px;
      flex-shrink:0;
    }

    /* chevron ÙŠØ¯ÙˆØ± Ù„Ù…Ø§ ÙŠÙØªØ­ */
    .shiftSummary::after {
      content:'â–¾';
      font-size:14px;
      color:#94a3b8;
      transition:transform .2s;
      flex-shrink:0;
    }
    .shiftCard[open] .shiftSummary::after {
      transform:rotate(180deg);
    }

    .shiftBody { background:rgba(255,255,255,.7); }

    /* â”€â”€ employee row â”€â”€ */
    .empRow {
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:9px 16px;
      border-top:1px solid rgba(15,23,42,.06);
    }
    .empRowAlt { background:rgba(15,23,42,.02); }
    .empName  { font-size:15px; font-weight:700; color:#1e293b; }
    .empStatus { font-size:13px; font-weight:600; }

    /* â•â•â•â•â•â•â• CTA â•â•â•â•â•â•â• */
    .btnWrap { margin-top:20px; text-align:center; }
    .btn {
      display:inline-block;
      padding:14px 38px;
      border-radius:16px;
      background:linear-gradient(135deg, #1e40af, #1976d2);
      color:#fff !important;
      text-decoration:none;
      font-weight:800;
      font-size:15px;
      box-shadow:0 6px 20px rgba(30,64,175,.3);
    }

    /* â•â•â•â•â•â•â• FOOTER â•â•â•â•â•â•â• */
    .footer { margin-top:18px; text-align:center; font-size:12px; color:#94a3b8; padding:12px 0; line-height:1.9; }
    .footer strong { color:#64748b; }

    /* â•â•â•â•â•â•â• MOBILE â•â•â•â•â•â•â• */
    @media (max-width:480px){
      .wrap            { padding:12px 10px 22px; }
      .header h1       { font-size:21px; }
      .deptTitle       { font-size:16px; }
      .empName         { font-size:14px; }
      .empStatus       { font-size:12px; }
      .shiftLabel      { font-size:14px; }
      .summaryBar      { gap:8px; }
      .summaryChip     { padding:8px 14px; }
      .summaryChip .chipVal { font-size:19px; }
    }

  </style>
</head>
<body>
<div class="wrap">

  <!-- â•â•â•â• HEADER â•â•â•â• -->
  <div class="header">
    <button class="langToggle" id="langToggle" onclick="toggleLang()">Ø¹</button>
    <h1 id="pageTitle">ğŸ“‹ Duty Roster</h1>
    <div class="datePickerWrapper">
      <button class="dateTag" id="dateTag" type="button" onclick="openCalPopup()">ğŸ“… 23 January 2026</button>
    </div>
    <!-- Custom Calendar Popup -->
    <div class="calOverlay" id="calOverlay" onclick="closeCalPopup()"></div>
    <div class="calPopup" id="calPopup">
      <div class="calHeader">
        <button onclick="calPrevMonth()">&#8249;</button>
        <span class="calMonthYear" id="calMonthYear"></span>
        <button onclick="calNextMonth()">&#8250;</button>
      </div>
      <div class="calGrid" id="calGrid"></div>
      <div class="calClose"><button onclick="closeCalPopup()">âœ• Close</button></div>
    </div>
  </div>

  <div class='deptCard' style='padding:14px;border:1px dashed rgba(15,23,42,.20);background:#fff;'>âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±ÙˆØ³ØªØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø± Ø¨Ø¹Ø¯.</div>

  <!-- â•â•â•â• SUMMARY CHIPS â•â•â•â• -->
  <div class="summaryBar">
    <div class="summaryChip">
      <div class="chipVal">0</div>
      <div class="chipLabel" data-key="employees">Employees</div>
    </div>
    <div class="summaryChip">
      <div class="chipVal" style="color:#059669;">0</div>
      <div class="chipLabel" data-key="departments">Departments</div>
    </div>
    
    <button class="summaryChip shiftFilterBtn morning" data-shift="Morning" style="cursor:pointer;">
      <div class="chipVal">â˜€ï¸</div>
      <div class="chipLabel">Morning</div>
    </button>
    <button class="summaryChip shiftFilterBtn afternoon" data-shift="Afternoon" style="cursor:pointer;">
      <div class="chipVal">ğŸŒ¤ï¸</div>
      <div class="chipLabel">Afternoon</div>
    </button>
    <button class="summaryChip shiftFilterBtn night" data-shift="Night" style="cursor:pointer;">
      <div class="chipVal">ğŸŒ™</div>
      <div class="chipLabel">Night</div>
    </button>
    <button class="summaryChip shiftFilterBtn all active" data-shift="All" style="cursor:pointer;">
      <div class="chipVal">ğŸ“‹</div>
      <div class="chipLabel">All Shifts</div>
    </button>
    
  </div>

  <!-- â•â•â•â• DEPARTMENT CARDS â•â•â•â• -->
  

  <!-- â•â•â•â• CTA â•â•â•â• -->
  <div class="btnWrap">
    <a class="btn" id="ctaBtn" href="https://khalidsaif912.github.io/roster-site/">ğŸ“‹ View Full Duty Roster</a>
  </div>

<div class="btnWrap">
  <a href="https://khalidsaif912.github.io/roster-site/subscribe/" class="btn" id="subscribeBtn">ğŸ“© Subscribe</a>
</div>

  <!-- â•â•â•â• FOOTER â•â•â•â• -->
  <div class="footer">
    <strong style="color:#475569;font-size:13px;">Last Updated:</strong> <strong style="color:#1e40af;">23JAN2026 / 00:00</strong>
    <br>Total: <strong>0 employees</strong>
     &nbsp;Â·&nbsp; Source: <strong>Export New Roster-February_2026RAMADAN-Versio&4.xlsx</strong>
  </div>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Auto-redirect to today if page date is outdated
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  var path = window.location.pathname || '/';
  var dateMatch = path.match(/\/date\/(\d{4})-(\d{2})-(\d{2})\//);
  if (!dateMatch) return;

  var pageDate = dateMatch[1] + '-' + dateMatch[2] + '-' + dateMatch[3];
  var now = new Date();
  var mus = new Date(now.getTime() + (4*3600000) + (now.getTimezoneOffset()*60000));
  var todayStr = mus.getFullYear() + '-' +
    String(mus.getMonth()+1).padStart(2,'0') + '-' +
    String(mus.getDate()).padStart(2,'0');

  if (pageDate !== todayStr) {
    if (sessionStorage.getItem('pageLoaded')) {
      sessionStorage.removeItem('pageLoaded');
      var base = path
        .replace(/\/date\/\d{4}-\d{2}-\d{2}\/.*$/,'/')
        .replace(/\/now\/.*$/,'/')
        .replace(/\/+$/,'');
      var isNow = path.includes('/now');
      window.location.href = base + '/date/' + todayStr + '/' + (isNow ? 'now/' : '');
    } else {
      sessionStorage.setItem('pageLoaded','true');
    }
  }
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Shift Filter (NOW PAGE ONLY)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  var filterBtns = document.querySelectorAll('.shiftFilterBtn');
  if(!filterBtns.length) return; // Not a /now/ page
  
  var allShiftCards = document.querySelectorAll('.shiftCard');
  
  // Group shift cards by shift type
  var shiftGroups = {};
  allShiftCards.forEach(function(card){
    var summary = card.querySelector('.shiftSummary');
    if(!summary) return;
    
    var label = summary.querySelector('.shiftLabel');
    if(!label) return;
    
    var shiftType = label.textContent.trim();
    if(!shiftGroups[shiftType]) shiftGroups[shiftType] = [];
    shiftGroups[shiftType].push(card);
  });
  
  // Determine current shift based on time
  function getCurrentShift(){
    var now = new Date();
    var muscatTime = new Date(now.getTime() + (4 * 60 * 60 * 1000) + (now.getTimezoneOffset() * 60 * 1000));
    var hour = muscatTime.getHours();
    var minute = muscatTime.getMinutes();
    var t = hour * 60 + minute;
    
    if(t >= 21 * 60 || t < 5 * 60) return 'Night';
    if(t >= 13 * 60) return 'Afternoon';
    return 'Morning';
  }
  
  // Set active shift on load - default to current shift
  var currentShift = getCurrentShift();
  filterBtns.forEach(function(btn){
    if(btn.dataset.shift === currentShift){
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });
  
  // Filter function
  function filterShifts(selectedShift){
    var totalEmployees = 0;
    
    if(selectedShift === 'All'){
      // Show all shifts
      allShiftCards.forEach(function(card){
        card.style.display = '';
        var count = card.querySelector('.shiftCount');
        if(count) totalEmployees += parseInt(count.textContent) || 0;
      });
    } else {
      // Hide all cards first
      allShiftCards.forEach(function(card){ card.style.display = 'none'; });
      
      // Show only selected shift cards and count employees
      if(shiftGroups[selectedShift]){
        shiftGroups[selectedShift].forEach(function(card){
          card.style.display = '';
          // Auto-open the selected shift
          card.setAttribute('open', '');
          // Count employees in this card
          var count = card.querySelector('.shiftCount');
          if(count) totalEmployees += parseInt(count.textContent) || 0;
        });
      }
      
      // Also show Off Day, Leave, Training, Standby in all shifts
      var alwaysShow = ['Off Day', 'Annual Leave', 'Sick Leave', 'Training', 'Standby', 'Other'];
      alwaysShow.forEach(function(type){
        if(shiftGroups[type]){
          shiftGroups[type].forEach(function(card){
            card.style.display = '';
            // Count employees
            var count = card.querySelector('.shiftCount');
            if(count) totalEmployees += parseInt(count.textContent) || 0;
          });
        }
      });
    }
    
    // Update employee count in summary
    var employeeChip = document.querySelector('.summaryChip .chipVal');
    if(employeeChip){
      employeeChip.textContent = totalEmployees;
    }
    
    // Update button states
    filterBtns.forEach(function(btn){
      if(btn.dataset.shift === selectedShift){
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });
  }
  
  // Add click handlers
  filterBtns.forEach(function(btn){
    btn.addEventListener('click', function(){
      filterShifts(this.dataset.shift);
    });
  });
  
  // Auto-filter on page load - show current shift
  filterShifts(currentShift);
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Custom Calendar Popup
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  var CAL_MIN = '2026-01-01';
  var CAL_MAX = '2026-03-31';
  var CAL_CURRENT = '2026-01-23';

  var MONTHS_EN = ['January','February','March','April','May','June',
                   'July','August','September','October','November','December'];

  var calYear, calMonth;
  var todayMus = (function(){
    var n=new Date();
    var m=new Date(n.getTime()+(4*3600000)+(n.getTimezoneOffset()*60000));
    return m.getFullYear()+'-'+String(m.getMonth()+1).padStart(2,'0')+'-'+String(m.getDate()).padStart(2,'0');
  })();

  function parseDate(s){
    if(!s) return null;
    var p=s.split('-');
    return {y:+p[0],m:+p[1]-1,d:+p[2]};
  }

  function isoStr(y,m,d){
    return y+'-'+String(m+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');
  }

  function renderCal(){
    var grid=document.getElementById('calGrid');
    var title=document.getElementById('calMonthYear');
    if(!grid||!title) return;
    title.textContent=MONTHS_EN[calMonth]+' '+calYear;

    var days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    var html=days.map(function(d){return '<div class="calDayName">'+d+'</div>';}).join('');

    var first=new Date(calYear,calMonth,1).getDay();
    var total=new Date(calYear,calMonth+1,0).getDate();
    var prevTotal=new Date(calYear,calMonth,0).getDate();

    // prev month padding
    for(var i=first-1;i>=0;i--){
      html+='<button class="calDay other-month" disabled>'+(prevTotal-i)+'</button>';
    }

    var minD=parseDate(CAL_MIN);
    var maxD=parseDate(CAL_MAX);
    var selD=parseDate(CAL_CURRENT);
    var todD=parseDate(todayMus);

    for(var d=1;d<=total;d++){
      var iso=isoStr(calYear,calMonth,d);
      var cls='calDay';
      var dis='';

      if(selD&&selD.y===calYear&&selD.m===calMonth&&selD.d===d) cls+=' selected';
      else if(todD&&todD.y===calYear&&todD.m===calMonth&&todD.d===d) cls+=' today';

      if((minD&&(calYear<minD.y||(calYear===minD.y&&calMonth<minD.m)||(calYear===minD.y&&calMonth===minD.m&&d<minD.d)))||
         (maxD&&(calYear>maxD.y||(calYear===maxD.y&&calMonth>maxD.m)||(calYear===maxD.y&&calMonth===maxD.m&&d>maxD.d)))){
        dis='disabled';
        cls+=' other-month';
      }

      html+='<button class="'+cls+'" '+dis+' onclick="calSelectDay(''+iso+'')">'+d+'</button>';
    }

    // next month padding
    var remaining=(7-((first+total)%7))%7;
    for(var n=1;n<=remaining;n++){
      html+='<button class="calDay other-month" disabled>'+n+'</button>';
    }

    grid.innerHTML=html;
  }

  window.openCalPopup=function(){
    var d=parseDate(CAL_CURRENT)||parseDate(todayMus)||{y:new Date().getFullYear(),m:new Date().getMonth(),d:1};
    calYear=d.y; calMonth=d.m;
    renderCal();
    document.getElementById('calPopup').classList.add('open');
    document.getElementById('calOverlay').classList.add('open');
  };

  window.closeCalPopup=function(){
    document.getElementById('calPopup').classList.remove('open');
    document.getElementById('calOverlay').classList.remove('open');
  };

  window.calPrevMonth=function(){
    calMonth--;
    if(calMonth<0){calMonth=11;calYear--;}
    renderCal();
  };

  window.calNextMonth=function(){
    calMonth++;
    if(calMonth>11){calMonth=0;calYear++;}
    renderCal();
  };

  window.calSelectDay=function(iso){
    sessionStorage.removeItem('pageLoaded');
    var path=window.location.pathname||'/';
    var isNow=path.includes('/now');
    var base=path
      .replace(/\/date\/\d{4}-\d{2}-\d{2}\/.*$/,'/')
      .replace(/\/now\/.*$/,'/')
      .replace(/\/+$/,'');
    var target=base+'/date/'+iso+'/';
    if(isNow) target+='now/';
    window.location.href=target;
  };
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Language Toggle - Arabic / English
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var LANG = localStorage.getItem('rosterLang') || 'en';

var T = {
  en: {
    title:        'ğŸ“‹ Duty Roster',
    langBtn:      'Ø¹',
    employees:    'Employees',
    departments:  'Departments',
    total:        'Total',
    morning:      'Morning',
    afternoon:    'Afternoon',
    night:        'Night',
    offday:       'Off Day',
    annualLeave:  'Annual Leave',
    sickLeave:    'Sick Leave',
    training:     'Training',
    standby:      'Standby',
    other:        'Other',
    from:         'FROM',
    to:           'TO',
    viewFull:     'ğŸ“‹ View Full Duty Roster',
    subscribe:    'ğŸ“© Subscribe',
    lastUpdated:  'Last Updated',
    totalLabel:   'Total',
    source:       'Source',
    allShift:     'All Shifts',
    morning2:     'Morning',
    afternoon2:   'Afternoon',
    night2:       'Night',
    officers:     'Officers',
    supervisors:  'Supervisors',
    loadControl:  'Load Control',
    exportChecker:'Export Checker',
    exportOps:    'Export Operators',
    unassigned:   'Unassigned',
  },
  ar: {
    title:        'ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª',
    langBtn:      'EN',
    employees:    'Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†',
    departments:  'Ø§Ù„Ø£Ù‚Ø³Ø§Ù…',
    total:        'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹',
    morning:      'ØµØ¨Ø§Ø­ÙŠ',
    afternoon:    'Ù…Ø³Ø§Ø¦ÙŠ',
    night:        'Ù„ÙŠÙ„ÙŠ',
    offday:       'Ø¥Ø¬Ø§Ø²Ø©',
    annualLeave:  'Ø¥Ø¬Ø§Ø²Ø© Ø³Ù†ÙˆÙŠØ©',
    sickLeave:    'Ø¥Ø¬Ø§Ø²Ø© Ù…Ø±Ø¶ÙŠØ©',
    training:     'ØªØ¯Ø±ÙŠØ¨',
    standby:      'Ø§Ø­ØªÙŠØ§Ø·',
    other:        'Ø£Ø®Ø±Ù‰',
    from:         'Ù…Ù†',
    to:           'Ø¥Ù„Ù‰',
    viewFull:     'ğŸ“‹ Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„',
    subscribe:    'ğŸ“© Ø§Ø´ØªØ±Ø§Ùƒ',
    lastUpdated:  'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«',
    totalLabel:   'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹',
    source:       'Ø§Ù„Ù…ØµØ¯Ø±',
    allShift:     'Ø§Ù„ÙƒÙ„',
    morning2:     'ØµØ¨Ø§Ø­ÙŠ',
    afternoon2:   'Ù…Ø³Ø§Ø¦ÙŠ',
    night2:       'Ù„ÙŠÙ„ÙŠ',
    officers:     'Ø§Ù„Ø¶Ø¨Ø§Ø·',
    supervisors:  'Ø§Ù„Ù…Ø´Ø±ÙÙˆÙ†',
    loadControl:  'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø­Ù…ÙˆÙ„Ø©',
    exportChecker:'Ù…Ø¯Ù‚Ù‚ Ø§Ù„ØµØ§Ø¯Ø±Ø§Øª',
    exportOps:    'Ù…Ø´ØºÙ„Ùˆ Ø§Ù„ØµØ§Ø¯Ø±Ø§Øª',
    unassigned:   'ØºÙŠØ± Ù…ÙØ¹ÙŠÙÙ‘Ù†',
  }
};

function applyLang(lang) {
  var t = T[lang];
  var isAr = lang === 'ar';

  document.body.classList.toggle('ar', isAr);
  document.documentElement.setAttribute('lang', lang);

  var el = document.getElementById('pageTitle');
  if(el) el.textContent = t.title;

  var btn = document.getElementById('langToggle');
  if(btn) btn.textContent = t.langBtn;

  // Summary chip labels
  document.querySelectorAll('.chipLabel').forEach(function(el) {
    var key = el.dataset.key;
    if(key === 'employees') el.textContent = t.employees;
    else if(key === 'departments') el.textContent = t.departments;
    else if(key === 'morning') el.textContent = t.morning2;
    else if(key === 'afternoon') el.textContent = t.afternoon2;
    else if(key === 'night') el.textContent = t.night2;
    else if(key === 'allShifts') el.textContent = t.allShift;
  });

  // Dept badge Total
  document.querySelectorAll('.deptBadge span:first-child').forEach(function(el) {
    el.textContent = t.total;
  });

  // Dept titles
  var deptMap = {
    'Officers': t.officers, 'Supervisors': t.supervisors,
    'Load Control': t.loadControl, 'Export Checker': t.exportChecker,
    'Export Operators': t.exportOps, 'Unassigned': t.unassigned
  };
  document.querySelectorAll('.deptTitle').forEach(function(el) {
    if(!el.dataset.key) el.dataset.key = el.textContent.trim();
    var key = el.dataset.key;
    if(deptMap[key]) el.textContent = deptMap[key];
  });

  // Shift labels
  var shiftMap = {
    'Morning': t.morning, 'Afternoon': t.afternoon, 'Night': t.night,
    'Off Day': t.offday, 'Annual Leave': t.annualLeave, 'Sick Leave': t.sickLeave,
    'Training': t.training, 'Standby': t.standby, 'Other': t.other
  };
  document.querySelectorAll('.shiftLabel').forEach(function(el) {
    if(!el.dataset.key) el.dataset.key = el.textContent.trim();
    var key = el.dataset.key;
    if(shiftMap[key]) el.textContent = shiftMap[key];
  });

  // FROM / TO spans
  document.querySelectorAll('.empStatus span').forEach(function(el) {
    var txt = el.textContent.trim();
    if(txt === 'FROM' || txt === 'Ù…Ù†') el.textContent = t.from;
    if(txt === 'TO'   || txt === 'Ø¥Ù„Ù‰') el.textContent = t.to;
  });

  // CTA buttons
  var ctaBtn = document.getElementById('ctaBtn');
  if(ctaBtn) ctaBtn.textContent = t.viewFull;
  var subBtn = document.getElementById('subscribeBtn');
  if(subBtn) subBtn.textContent = t.subscribe;

  // Footer
  var footer = document.querySelector('.footer');
  if(footer) {
    var html = footer.innerHTML;
    if(isAr) {
      html = html.replace('Last Updated', 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«');
      html = html.replace('Total:', 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:');
      html = html.replace(' employees', ' Ù…ÙˆØ¸Ù');
      html = html.replace('Source:', 'Ø§Ù„Ù…ØµØ¯Ø±:');
    } else {
      html = html.replace('Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«', 'Last Updated');
      html = html.replace('Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:', 'Total:');
      html = html.replace(' Ù…ÙˆØ¸Ù', ' employees');
      html = html.replace('Ø§Ù„Ù…ØµØ¯Ø±:', 'Source:');
    }
    footer.innerHTML = html;
  }

  localStorage.setItem('rosterLang', lang);
  LANG = lang;
}

function toggleLang() {
  applyLang(LANG === 'en' ? 'ar' : 'en');
}

applyLang(LANG);
</script>

</body>
</html>