<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>My Schedule</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}

    :root{
      --bg:#f0f4ff;
      --card:#fff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e5e7eb;
      --b1:#1e73ff;
      --b2:#00b3ff;
      --b3:#2b59ff;
      --r:14px;
    }

    body{
      font-family:'Segoe UI',system-ui,sans-serif;
      background:radial-gradient(ellipse 120% 40% at 50% 0%,rgba(30,115,255,.15),transparent 60%),
                 linear-gradient(180deg,var(--bg),#fff 70%);
      min-height:100vh;
      padding:8px;
      color:var(--text);
      font-size:13px;
    }

    .wrap{max-width:520px;margin:0 auto;display:flex;flex-direction:column;gap:8px}

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero{
      background:linear-gradient(135deg,var(--b3),var(--b2));
      border-radius:var(--r);
      padding:10px 12px;
      position:relative;overflow:hidden;
    }
    .hero::before{
      content:"";position:absolute;
      top:-40px;right:-40px;
      width:120px;height:120px;
      border-radius:50%;
      background:rgba(255,255,255,.12);
    }
    .hero-row{
      position:relative;
      display:flex;align-items:center;justify-content:space-between;gap:8px;
    }
    .brand{display:flex;align-items:center;gap:8px}
    .logo{
      width:34px;height:34px;border-radius:10px;
      background:rgba(255,255,255,.22);border:1px solid rgba(255,255,255,.25);
      display:flex;align-items:center;justify-content:center;font-size:16px;
      flex-shrink:0;
    }
    .brand-text h1{color:#fff;font-size:14px;font-weight:800;line-height:1.2}
    .brand-text p{color:rgba(255,255,255,.85);font-size:10px;font-weight:600}

    .hero-btns{display:flex;gap:6px;align-items:center}

    /* lang toggle */
    .lang-btn{
      background:rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.3);
      color:#fff;
      border-radius:8px;
      padding:4px 9px;
      font-size:11px;font-weight:700;
      cursor:pointer;transition:background .2s;
      white-space:nowrap;
    }
    .lang-btn:hover{background:rgba(255,255,255,.28)}

    .back-btn{
      background:rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.3);
      color:#fff;border-radius:8px;
      padding:4px 9px;font-size:11px;font-weight:700;
      cursor:pointer;transition:background .2s;white-space:nowrap;
    }
    .back-btn:hover{background:rgba(255,255,255,.28)}

    /* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
    .card{
      background:var(--card);
      border-radius:var(--r);
      box-shadow:0 4px 20px rgba(2,6,23,.07);
      border:1px solid var(--border);
      overflow:hidden;
    }

    /* ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ */
    .search-area{
      padding:10px 12px;
      background:linear-gradient(180deg,#fff,#fbfcff);
      border-bottom:1px solid var(--border);
    }
    .search-row{display:flex;gap:7px}
    .search-input{
      flex:1;min-width:0;
      padding:9px 12px;
      border:1.5px solid var(--border);
      border-radius:10px;
      font-size:13px;
      direction:ltr;
      background:#fff;
      transition:border-color .2s,box-shadow .2s;
    }
    .search-input:focus{
      outline:none;
      border-color:rgba(30,115,255,.7);
      box-shadow:0 0 0 3px rgba(30,115,255,.1);
    }
    .search-btn{
      padding:9px 14px;
      background:linear-gradient(135deg,var(--b3),var(--b2));
      color:#fff;border:none;border-radius:10px;
      font-size:12px;font-weight:800;
      cursor:pointer;transition:transform .2s,box-shadow .2s;
      white-space:nowrap;
    }
    .search-btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(30,115,255,.28)}

    /* ‚îÄ‚îÄ CONTENT ‚îÄ‚îÄ */
    .content{padding:10px}
    .empty-state{text-align:center;padding:30px 16px;color:var(--muted)}
    .empty-icon{font-size:36px;margin-bottom:8px}
    .empty-state h3{font-size:14px;margin-bottom:4px;color:var(--text)}
    .empty-state p{font-size:11px}

    /* ‚îÄ‚îÄ EMPLOYEE INFO BAR ‚îÄ‚îÄ */
    .emp-bar{
      background:linear-gradient(135deg,var(--b3),var(--b2));
      color:#fff;
      border-radius:10px;
      padding:8px 10px;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      box-shadow:0 4px 14px rgba(30,115,255,.2);
    }
    .emp-info h2{font-size:13px;font-weight:800;line-height:1.3}
    .emp-info p{font-size:10px;opacity:.9;margin-top:1px}
    .month-nav{display:flex;align-items:center;gap:6px;flex-shrink:0}
    .month-nav button{
      width:28px;height:28px;
      border-radius:50%;
      background:rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.25);
      color:#fff;font-size:14px;
      cursor:pointer;transition:background .2s;
      display:flex;align-items:center;justify-content:center;
    }
    .month-nav button:hover{background:rgba(255,255,255,.3)}
    .month-nav span{font-size:11px;font-weight:800;min-width:80px;text-align:center}

    /* ‚îÄ‚îÄ CALENDAR ‚îÄ‚îÄ */
    .calendar{
      background:#fff;
      border-radius:10px;
      border:1px solid var(--border);
      overflow:hidden;
      margin-bottom:8px;
    }
    .cal-head{
      display:grid;grid-template-columns:repeat(7,1fr);
      background:#f8fafc;
      border-bottom:1.5px solid var(--border);
    }
    .cal-head div{
      padding:6px 2px;
      text-align:center;
      font-weight:800;
      color:#475569;
      font-size:9px;
    }
    .cal-body{display:grid;grid-template-columns:repeat(7,1fr)}

    .cal-day{
      border:1px solid #f0f0f0;
      padding:3px 2px;
      background:#fff;
      min-height:52px;
      display:flex;flex-direction:column;align-items:center;
    }
    .cal-day.empty{background:#fafafa}
    .cal-day.today{box-shadow:inset 0 0 0 2px var(--b1)}

    .d-num{font-size:10px;font-weight:900;color:#0f172a;margin-bottom:1px}
    .d-icon{font-size:14px;line-height:1;margin:1px 0}
    .d-lbl{
      font-size:7.5px;font-weight:800;text-align:center;
      padding:1px 3px;border-radius:5px;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      max-width:100%;
    }
    .d-code{font-size:7px;color:var(--muted);font-weight:700;margin-top:1px}

    .s-morning{background:#fef3c7;color:#92400e}
    .s-afternoon{background:#fed7aa;color:#9a3412}
    .s-night{background:#ddd6fe;color:#5b21b6}
    .s-off{background:#f1f5f9;color:#475569}
    .s-leave{background:#dcfce7;color:#166534}
    .s-training{background:#dbeafe;color:#1e40af}
    .s-standby{background:#fce7f3;color:#9f1239}
    .s-other{background:#f3f4f6;color:#6b7280}

    /* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
    .stats{
      background:#f8fafc;
      border-radius:10px;
      border:1px solid var(--border);
      padding:8px;
      margin-bottom:8px;
    }
    .stats-title{
      font-size:10px;font-weight:800;
      color:var(--muted);
      margin-bottom:6px;
      text-transform:uppercase;
      letter-spacing:.5px;
    }
    .stats-grid{
      display:grid;
      grid-template-columns:repeat(6,1fr);
      gap:4px;
    }
    @media(max-width:360px){
      .stats-grid{grid-template-columns:repeat(3,1fr)}
    }
    .stat-box{
      background:#fff;
      border:1px solid var(--border);
      border-radius:7px;
      padding:5px 4px;
      text-align:center;
    }
    .stat-lbl{font-size:8px;color:var(--muted);font-weight:700;margin-bottom:2px}
    .stat-val{font-size:16px;font-weight:900;color:var(--text);line-height:1}

    /* ‚îÄ‚îÄ ACTIONS ‚îÄ‚îÄ */
    .actions{display:flex;gap:5px;flex-wrap:wrap}
    .act-btn{
      flex:1;min-width:0;
      padding:7px 8px;
      border:1.5px solid var(--border);
      background:#fff;
      border-radius:9px;
      font-size:10px;font-weight:800;
      cursor:pointer;transition:all .2s;
      display:flex;align-items:center;justify-content:center;gap:4px;
      white-space:nowrap;
    }
    .act-btn:hover{border-color:rgba(30,115,255,.5);color:var(--b1);transform:translateY(-1px)}
    .act-primary{
      background:linear-gradient(135deg,var(--b3),var(--b2));
      color:#fff;border-color:transparent;
    }
    .act-primary:hover{color:#fff;border-color:transparent;box-shadow:0 6px 18px rgba(30,115,255,.26)}

    /* Loading */
    .loading{text-align:center;padding:30px 16px;color:var(--muted)}
    .spinner{
      width:32px;height:32px;
      border:3px solid #e5e7eb;
      border-top-color:var(--b1);
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin:0 auto 10px;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .loading p{font-size:11px}
  </style>
</head>
<body>
<div class="wrap">

  <!-- HERO -->
  <div class="hero">
    <div class="hero-row">
      <div class="brand">
        <div class="logo">üìÖ</div>
        <div class="brand-text">
          <h1 id="ttl">My Schedule</h1>
          <p id="sub">Enter your Employee ID to view schedule</p>
        </div>
      </div>
      <div class="hero-btns">
        <button class="lang-btn" onclick="toggleLang()">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
        <button class="back-btn" onclick="goBack()">‚Üê Back</button>
      </div>
    </div>
  </div>

  <!-- MAIN CARD -->
  <div class="card">
    <div class="search-area">
      <form class="search-row" id="searchForm">
        <input type="text" class="search-input" id="empId"
          placeholder="Employee ID (e.g. 12345)"
          pattern="[0-9]+" required>
        <button type="submit" class="search-btn" id="sbtn">üìÖ View</button>
      </form>
    </div>
    <div class="content" id="area">
      <div class="empty-state">
        <div class="empty-icon">üîç</div>
        <h3 id="e1">Search your schedule</h3>
        <p id="e2">Enter your Employee ID above</p>
      </div>
    </div>
  </div>

</div>

<script>
  let data=null, month=null, months=[], lang='en';

  /* ‚îÄ‚îÄ TRANSLATIONS ‚îÄ‚îÄ */
  const T={
    en:{
      title:'My Schedule', sub:'Enter your Employee ID to view schedule',
      back:'‚Üê Back', langBtn:'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',
      ph:'Employee ID (e.g. 12345)', sbtn:'üìÖ View',
      e1:'Search your schedule', e2:'Enter your Employee ID above',
      loading:'Loading...', notFound:'Employee not found',
      notFoundSub:'ID not in the system. Please check and try again.',
      statsTitle:'STATISTICS',
      workDays:'Work Days', offDays:'Off Days',
      morning:'Morning', afternoon:'Afternoon', night:'Night', leaves:'Leaves',
      pdf:'üì• PDF', share:'üîó Share', print:'üñ®Ô∏è Print',
      shiftNames:{Morning:'Morning',Afternoon:'Afternoon',Night:'Night',
        'Off Day':'Off','Annual Leave':'Leave','Sick Leave':'Sick',
        Training:'Training',Standby:'Standby',Other:'Other'},
      days:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],
      months:['January','February','March','April','May','June',
              'July','August','September','October','November','December']
    },
    ar:{
      title:'ÿ¨ÿØŸàŸÑŸä', sub:'ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖŸÉ ÿßŸÑŸàÿ∏ŸäŸÅŸä ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ¨ÿØŸàŸÑ',
      back:'ÿ±ÿ¨Ÿàÿπ ‚Üê', langBtn:'English',
      ph:'ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑŸàÿ∏ŸäŸÅŸä (ŸÖÿ´ÿßŸÑ: 12345)', sbtn:'üìÖ ÿπÿ±ÿ∂',
      e1:'ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ¨ÿØŸàŸÑŸÉ', e2:'ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖŸÉ ÿßŸÑŸàÿ∏ŸäŸÅŸä ÿ£ÿπŸÑÿßŸá',
      loading:'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...', notFound:'ŸÑŸÖ ŸäŸèÿπÿ´ÿ± ÿπŸÑŸâ ŸÖŸàÿ∏ŸÅ',
      notFoundSub:'ÿßŸÑÿ±ŸÇŸÖ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ. ÿ™ÿ≠ŸÇŸÇ Ÿàÿ£ÿπÿØ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©.',
      statsTitle:'ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™',
      workDays:'ÿ£ŸäÿßŸÖ ÿπŸÖŸÑ', offDays:'ÿ•ÿ¨ÿßÿ≤ÿßÿ™',
      morning:'ÿµÿ®ÿßÿ≠', afternoon:'ŸÖÿ≥ÿßÿ°', night:'ŸÑŸäŸÑ', leaves:'ÿ•ÿ¨ÿßÿ≤ÿßÿ™ ÿ≥ŸÜŸàŸäÿ©',
      pdf:'üì• PDF', share:'üîó ŸÖÿ¥ÿßÿ±ŸÉÿ©', print:'üñ®Ô∏è ÿ∑ÿ®ÿßÿπÿ©',
      shiftNames:{Morning:'ÿµÿ®ÿßÿ≠Ÿäÿ©',Afternoon:'ŸÖÿ≥ÿßÿ¶Ÿäÿ©',Night:'ŸÑŸäŸÑŸäÿ©',
        'Off Day':'ÿ•ÿ¨ÿßÿ≤ÿ©','Annual Leave':'ÿ≥ŸÜŸàŸäÿ©','Sick Leave':'ŸÖÿ±ÿ∂Ÿäÿ©',
        Training:'ÿ™ÿØÿ±Ÿäÿ®',Standby:'ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä',Other:'ÿ£ÿÆÿ±Ÿâ'},
      days:['ÿßŸÑÿ£ÿ≠','ÿßŸÑÿßÿ´','ÿßŸÑÿ´ŸÑ','ÿßŸÑÿ£ÿ±','ÿßŸÑÿÆŸÖ','ÿßŸÑÿ¨ŸÖ','ÿßŸÑÿ≥ÿ®'],
      months:['ŸäŸÜÿßŸäÿ±','ŸÅÿ®ÿ±ÿßŸäÿ±','ŸÖÿßÿ±ÿ≥','ÿ£ÿ®ÿ±ŸäŸÑ','ŸÖÿßŸäŸà','ŸäŸàŸÜŸäŸà',
              'ŸäŸàŸÑŸäŸà','ÿ£ÿ∫ÿ≥ÿ∑ÿ≥','ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±','ÿ£ŸÉÿ™Ÿàÿ®ÿ±','ŸÜŸàŸÅŸÖÿ®ÿ±','ÿØŸäÿ≥ŸÖÿ®ÿ±']
    }
  };

  function t(k){return T[lang][k]}

  function applyLangUI(){
    const dir=lang==='ar'?'rtl':'ltr';
    document.documentElement.lang=lang;
    document.documentElement.dir=dir;
    document.getElementById('ttl').textContent=t('title');
    document.getElementById('sub').textContent=t('sub');
    document.querySelector('.back-btn').textContent=t('back');
    document.querySelector('.lang-btn').textContent=t('langBtn');
    document.getElementById('empId').placeholder=t('ph');
    document.getElementById('sbtn').textContent=t('sbtn');
    const e1=document.getElementById('e1');
    const e2=document.getElementById('e2');
    if(e1) e1.textContent=t('e1');
    if(e2) e2.textContent=t('e2');
    if(data) renderSchedule();
  }

  function toggleLang(){
    lang=lang==='en'?'ar':'en';
    applyLangUI();
  }

  function goBack(){
    const base=location.pathname.includes('/roster-site/')?'/roster-site/':'/';
    if(document.referrer&&document.referrer.includes(location.host)) history.back();
    else location.href=base;
  }

  document.getElementById('searchForm').addEventListener('submit',async e=>{
    e.preventDefault();
    const id=document.getElementById('empId').value.trim();
    if(id) await loadSchedule(id);
  });

  async function loadSchedule(id){
    document.getElementById('area').innerHTML=`
      <div class="loading"><div class="spinner"></div><p>${t('loading')}</p></div>`;
    try{
      const res=await fetch(`../schedules/${id}.json`);
      if(!res.ok) throw new Error('not found');
      data=await res.json();
      months=Object.keys(data.schedules).sort().reverse();
      if(!months.length) throw new Error('empty');
      month=months[0];
      renderSchedule();
    }catch{
      document.getElementById('area').innerHTML=`
        <div class="empty-state">
          <div class="empty-icon">‚ùå</div>
          <h3>${t('notFound')}</h3>
          <p>${t('notFoundSub')}</p>
        </div>`;
    }
  }

  function renderSchedule(){
    const sched=data.schedules[month];
    const [yr,mo]=month.split('-').map(Number);
    const mName=T[lang].months[mo-1];
    const ci=months.indexOf(month);
    const hasNext=ci>0, hasPrev=ci<months.length-1;

    /* calendar grid ‚Äî LTR always: Sun=0 Mon=1 ... Sat=6 */
    const firstDow=new Date(yr,mo-1,1).getDay();
    const daysInMonth=new Date(yr,mo,0).getDate();
    const stats=calcStats(sched);

    let cells='';
    let dc=1;
    for(let w=0;w<6;w++){
      for(let d=0;d<7;d++){
        if((w===0&&d<firstDow)||dc>daysInMonth){
          cells+='<div class="cal-day empty"></div>';
        }else{
          const dd=sched.find(s=>s.day===dc);
          const today=isToday(yr,mo,dc);
          if(dd){
            const sc=shiftClass(dd.shift_group);
            cells+=`<div class="cal-day${today?' today':''}">
              <div class="d-num">${dc}</div>
              <div class="d-icon">${shiftIcon(dd.shift_group)}</div>
              <div class="d-lbl ${sc}">${T[lang].shiftNames[dd.shift_group]||dd.shift_group}</div>
              ${dd.shift_code?`<div class="d-code">${esc(dd.shift_code)}</div>`:''}
            </div>`;
          }else{
            cells+=`<div class="cal-day${today?' today':''}">
              <div class="d-num">${dc}</div>
              <div class="d-icon">¬∑</div>
            </div>`;
          }
          dc++;
        }
      }
      if(dc>daysInMonth) break;
    }

    /* day headers ‚Äî always LTR Sun‚ÜíSat */
    const dayHdr=T[lang].days.map(d=>`<div>${d}</div>`).join('');

    document.getElementById('area').innerHTML=`
      <div class="emp-bar">
        <div class="emp-info">
          <h2>${esc(data.name)}</h2>
          <p>üìã ${esc(data.department)} &nbsp;‚Ä¢&nbsp; üÜî ${esc(data.id)}</p>
        </div>
        <div class="month-nav">
          <button onclick="chMonth(-1)" ${!hasPrev?'disabled style="opacity:.35;cursor:default"':''}>&lt;</button>
          <span>${mName} ${yr}</span>
          <button onclick="chMonth(1)" ${!hasNext?'disabled style="opacity:.35;cursor:default"':''}>&gt;</button>
        </div>
      </div>

      <div class="calendar">
        <div class="cal-head">${dayHdr}</div>
        <div class="cal-body">${cells}</div>
      </div>

      <div class="stats">
        <div class="stats-title">${t('statsTitle')}</div>
        <div class="stats-grid">
          <div class="stat-box"><div class="stat-lbl">${t('workDays')}</div><div class="stat-val">${stats.work}</div></div>
          <div class="stat-box"><div class="stat-lbl">${t('offDays')}</div><div class="stat-val">${stats.off}</div></div>
          <div class="stat-box"><div class="stat-lbl">${t('morning')}</div><div class="stat-val">${stats.morning}</div></div>
          <div class="stat-box"><div class="stat-lbl">${t('afternoon')}</div><div class="stat-val">${stats.afternoon}</div></div>
          <div class="stat-box"><div class="stat-lbl">${t('night')}</div><div class="stat-val">${stats.night}</div></div>
          <div class="stat-box"><div class="stat-lbl">${t('leaves')}</div><div class="stat-val">${stats.leaves}</div></div>
        </div>
      </div>

      <div class="actions">
        <button class="act-btn act-primary" onclick="dlPDF()">${t('pdf')}</button>
        <button class="act-btn" onclick="shareS()">${t('share')}</button>
        <button class="act-btn" onclick="window.print()">${t('print')}</button>
      </div>
    `;
  }

  function chMonth(dir){
    const ci=months.indexOf(month);
    const ni=ci-dir;
    if(ni>=0&&ni<months.length){month=months[ni];renderSchedule()}
  }

  function calcStats(s){
    const r={work:0,off:0,morning:0,afternoon:0,night:0,leaves:0};
    s.forEach(d=>{
      if(d.shift_group==='Morning') r.morning++;
      else if(d.shift_group==='Afternoon') r.afternoon++;
      else if(d.shift_group==='Night') r.night++;
      else if(d.shift_group==='Off Day') r.off++;
      else if(d.shift_group==='Annual Leave'||d.shift_group==='Sick Leave') r.leaves++;
    });
    r.work=r.morning+r.afternoon+r.night;
    return r;
  }

  function shiftIcon(g){
    return{Morning:'‚òÄÔ∏è',Afternoon:'üå§Ô∏è',Night:'üåô','Off Day':'üõå',
           'Annual Leave':'‚úàÔ∏è','Sick Leave':'ü§í',Training:'üìö',
           Standby:'üßç',Other:'‚ùì'}[g]||'‚ùì';
  }
  function shiftClass(g){
    return{Morning:'s-morning',Afternoon:'s-afternoon',Night:'s-night',
           'Off Day':'s-off','Annual Leave':'s-leave','Sick Leave':'s-leave',
           Training:'s-training',Standby:'s-standby',Other:'s-other'}[g]||'s-other';
  }
  function isToday(y,m,d){
    const t=new Date();
    return t.getFullYear()===y&&t.getMonth()+1===m&&t.getDate()===d;
  }
  function esc(s){
    return String(s??'')
      .replace(/&/g,'&amp;').replace(/</g,'&lt;')
      .replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }
  function dlPDF(){alert('Coming soon: PDF download')}
  function shareS(){
    const id=data.id;
    const base=location.pathname.includes('/roster-site/')?'/roster-site/':'/';
    const url=`${location.origin}${base}my-schedule/?emp=${encodeURIComponent(id)}`;
    if(navigator.share){
      navigator.share({title:'My Schedule',text:`Schedule: ${data.name}`,url});
    }else{
      navigator.clipboard.writeText(url);
      alert('Link copied!');
    }
  }

  /* auto-load */
  const p=new URLSearchParams(location.search).get('emp');
  if(p){document.getElementById('empId').value=p;loadSchedule(p);}
</script>
</body>
</html>
