<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My Schedule - Duty Roster</title>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root{
      --bg1:#f6f8ff;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e5e7eb;

      --brand1:#1e73ff;
      --brand2:#00b3ff;
      --brand3:#2b59ff;

      --shadow: 0 10px 30px rgba(2, 6, 23, 0.08);
      --shadow2: 0 8px 20px rgba(30, 115, 255, 0.18);
      --radius: 18px;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: radial-gradient(1200px 500px at 50% 0%, rgba(30,115,255,.18), transparent 60%),
                  radial-gradient(900px 450px at 20% 20%, rgba(0,179,255,.14), transparent 60%),
                  linear-gradient(180deg, var(--bg1), #ffffff 65%);
      min-height: 100vh;
      padding: 16px;
      color: var(--text);
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
    }

    /* Top hero like main page */
    .hero {
      border-radius: 26px;
      padding: 22px 18px;
      background: linear-gradient(135deg, var(--brand1), var(--brand2));
      box-shadow: var(--shadow2);
      position: relative;
      overflow: hidden;
      margin-bottom: 14px;
    }

    .hero::before{
      content:"";
      position:absolute;
      inset:-60px -80px auto auto;
      width:260px;
      height:260px;
      border-radius:50%;
      background: rgba(255,255,255,0.14);
      filter: blur(0px);
    }

    .hero::after{
      content:"";
      position:absolute;
      inset:auto auto -80px -60px;
      width:220px;
      height:220px;
      border-radius:50%;
      background: rgba(255,255,255,0.10);
    }

    .hero-inner{
      position:relative;
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .brand {
      display:flex;
      gap:12px;
      align-items:center;
    }
    .brand .logo{
      width:46px; height:46px;
      border-radius:14px;
      background: rgba(255,255,255,0.22);
      border: 1px solid rgba(255,255,255,0.25);
      display:flex; align-items:center; justify-content:center;
      font-size: 22px;
    }
    .brand h1{
      color:#fff;
      font-size: 22px;
      line-height: 1.2;
      margin-bottom: 2px;
    }
    .brand p{
      color: rgba(255,255,255,0.88);
      font-size: 13px;
      font-weight: 600;
    }

    .top-actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .btn{
      border: 0;
      cursor:pointer;
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 800;
      font-size: 14px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      transition: transform .2s ease, box-shadow .2s ease, opacity .2s ease;
      user-select:none;
      text-decoration:none;
      white-space:nowrap;
    }

    .btn:active{ transform: translateY(1px); }

    .btn-ghost{
      background: rgba(255,255,255,0.20);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.28);
    }
    .btn-ghost:hover{
      box-shadow: 0 10px 24px rgba(2,6,23,0.14);
    }

    .btn-primary{
      background: #fff;
      color: #0f172a;
      box-shadow: 0 12px 28px rgba(2,6,23,0.14);
    }
    .btn-primary:hover{
      transform: translateY(-2px);
    }

    /* Card shell */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      overflow:hidden;
    }

    .card-header {
      padding: 18px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .card-header .title{
      font-size: 18px;
      font-weight: 900;
    }
    .card-header .subtitle{
      color: var(--muted);
      font-size: 13px;
      font-weight: 600;
      margin-top: 4px;
    }

    /* Search area */
    .search-box {
      padding: 16px 18px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, #ffffff, #fbfcff);
    }

    .search-form {
      display: flex;
      gap: 10px;
      max-width: 640px;
      margin: 0 auto;
    }

    .search-input {
      flex: 1;
      padding: 14px 16px;
      border: 2px solid var(--border);
      border-radius: 14px;
      font-size: 15px;
      transition: all 0.25s;
      direction: ltr;
      text-align: left;
      background:#fff;
    }

    .search-input:focus {
      outline: none;
      border-color: rgba(30,115,255,0.7);
      box-shadow: 0 0 0 4px rgba(30,115,255,0.12);
    }

    .search-btn {
      padding: 14px 18px;
      background: linear-gradient(135deg, var(--brand3), var(--brand2));
      color: white;
      border: none;
      border-radius: 14px;
      font-size: 15px;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.25s;
    }

    .search-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(30,115,255,0.28);
    }

    /* Content area */
    .content {
      padding: 18px;
      min-height: 380px;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }

    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #e5e7eb;
      border-top-color: var(--brand1);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 18px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .empty-state {
      text-align: center;
      padding: 55px 20px;
    }

    .empty-state-icon { font-size: 56px; margin-bottom: 14px; }
    .empty-state h3 { font-size: 20px; margin-bottom: 8px; }
    .empty-state p { color: var(--muted); font-weight: 600; }

    /* Employee Info */
    .employee-info {
      background: linear-gradient(135deg, var(--brand3), var(--brand2));
      color: white;
      padding: 16px;
      border-radius: 16px;
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
      box-shadow: 0 10px 24px rgba(30,115,255,0.22);
    }

    .employee-details h2 {
      font-size: 18px;
      margin-bottom: 4px;
      font-weight: 900;
    }

    .employee-details p {
      opacity: 0.92;
      font-size: 13px;
      font-weight: 700;
    }

    .month-nav {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .month-nav button {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: rgba(255,255,255,0.18);
      border: 1px solid rgba(255,255,255,0.25);
      color: white;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .month-nav button:hover { background: rgba(255,255,255,0.26); }
    .month-nav span {
      font-size: 15px;
      font-weight: 900;
      min-width: 150px;
      text-align: center;
    }

    /* Calendar */
    .calendar {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .calendar-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      background: #f8fafc;
      border-bottom: 2px solid var(--border);
    }

    .calendar-header div {
      padding: 12px 6px;
      text-align: center;
      font-weight: 900;
      color: #475569;
      font-size: 12px;
    }

    .calendar-body {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }

    .calendar-day {
      aspect-ratio: 1;
      border: 1px solid var(--border);
      padding: 8px;
      transition: all 0.2s;
      background:#fff;
    }

    .calendar-day:hover { background: #f8fafc; }
    .calendar-day.empty { background: #fafafa; }
    .calendar-day.today { box-shadow: inset 0 0 0 2px rgba(30,115,255,0.8); }

    .day-number {
      font-size: 12px;
      font-weight: 900;
      color: #0f172a;
      margin-bottom: 3px;
    }

    .day-shift {
      text-align: center;
      font-size: 20px;
      margin: 6px 0;
    }

    .day-label {
      font-size: 10px;
      font-weight: 900;
      text-align: center;
      padding: 4px 6px;
      border-radius: 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .day-code {
      font-size: 10px;
      text-align: center;
      color: #64748b;
      margin-top: 4px;
      font-weight: 800;
    }

    /* Shift Colors */
    .shift-morning { background: #fef3c7; color: #92400e; }
    .shift-afternoon { background: #fed7aa; color: #9a3412; }
    .shift-night { background: #ddd6fe; color: #5b21b6; }
    .shift-off { background: #f1f5f9; color: #475569; }
    .shift-leave { background: #dcfce7; color: #166534; }
    .shift-training { background: #dbeafe; color: #1e40af; }
    .shift-standby { background: #fce7f3; color: #9f1239; }
    .shift-other { background: #f3f4f6; color: #6b7280; }

    /* Statistics */
    .statistics {
      margin-top: 16px;
      background: #f8fafc;
      padding: 16px;
      border-radius: 16px;
      border: 1px solid var(--border);
    }

    .statistics h3 {
      font-size: 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 900;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
    }

    .stat-card {
      background: white;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      transition: all 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 22px rgba(2,6,23,0.08);
    }

    .stat-label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
      font-weight: 800;
    }

    .stat-value {
      font-size: 22px;
      font-weight: 1000;
      color: #0f172a;
    }

    /* Actions */
    .actions {
      display: flex;
      gap: 10px;
      margin-top: 14px;
      flex-wrap: wrap;
    }

    .action-btn {
      flex: 1;
      min-width: 190px;
      padding: 12px 14px;
      border: 2px solid var(--border);
      background: white;
      border-radius: 14px;
      font-size: 14px;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .action-btn:hover {
      border-color: rgba(30,115,255,0.55);
      color: var(--brand1);
      transform: translateY(-2px);
      box-shadow: 0 10px 22px rgba(30,115,255,0.14);
    }

    .action-btn-primary {
      background: linear-gradient(135deg, var(--brand3), var(--brand2));
      color: white;
      border-color: transparent;
    }

    .action-btn-primary:hover {
      border-color: transparent;
      color: #fff;
      box-shadow: 0 12px 26px rgba(30,115,255,0.26);
    }

    /* Responsive */
    @media (max-width: 768px) {
      body{ padding: 12px; }
      .search-form { flex-direction: column; }
      .calendar-day { padding: 5px; }
      .day-shift { font-size: 16px; margin: 4px 0; }
      .day-label { font-size: 9px; }
      .month-nav span { min-width: 130px; }
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- HERO TOP (similar vibe to main page) -->
    <div class="hero">
      <div class="hero-inner">
        <div class="brand">
          <div class="logo">ğŸ“…</div>
          <div>
            <h1>Duty Roster</h1>
            <p>ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ø®ØµÙŠ</p>
          </div>
        </div>

        <div class="top-actions">
          <button class="btn btn-ghost" onclick="goBackToRoster()">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±ÙˆØ³ØªØ±</button>
          <a class="btn btn-primary" href="#search">ğŸ” Ø§Ø¨Ø­Ø« Ø§Ù„Ø¢Ù†</a>
        </div>
      </div>
    </div>

    <div class="card">
      <!-- Header -->
      <div class="card-header">
        <div>
          <div class="title">ğŸ—“ï¸ Ø¬Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</div>
          <div class="subtitle">Ø§Ø¹Ø±Ø¶ Ù…Ù†Ø§ÙˆØ¨Ø§ØªÙƒ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</div>
        </div>
      </div>

      <!-- Search Box -->
      <div class="search-box" id="search">
        <form class="search-form" id="searchForm">
          <input
            type="text"
            class="search-input"
            id="employeeId"
            placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ (Ù…Ø«Ø§Ù„: 12345)"
            pattern="[0-9]+"
            required
          >
          <button type="submit" class="search-btn">ğŸ“… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª</button>
        </form>
      </div>

      <!-- Content Area -->
      <div class="content" id="contentArea">
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ”</div>
          <h3>Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¬Ø¯ÙˆÙ„Ùƒ</h3>
          <p>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¹Ø±Ø¶ Ù…Ù†Ø§ÙˆØ¨Ø§ØªÙƒ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentData = null;
    let currentMonth = null;
    let availableMonths = [];

    // âœ… Back button logic (smart)
    function goBackToRoster(){
      // If user has history, go back. Otherwise go to site home.
      const base = location.pathname.includes("/roster-site/") ? "/roster-site/" : "/";
      if (document.referrer && document.referrer.includes(location.host)) {
        history.back();
      } else {
        location.href = base; // Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ø¥Ø°Ø§ ØµÙØ­ØªÙƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¯Ø§Ø®Ù„ /now/
      }
    }

    // Submit form
    document.getElementById('searchForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const empId = document.getElementById('employeeId').value.trim();
      if (empId) await loadEmployeeSchedule(empId);
    });

    // Load employee schedule
    async function loadEmployeeSchedule(empId) {
      const contentArea = document.getElementById('contentArea');

      // Show loading
      contentArea.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        </div>
      `;

      try {
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙØ­Ø© Ø¯Ø§Ø®Ù„ docs/my-schedule/ ÙÙ€ ../schedules ØµØ­ÙŠØ­
        const response = await fetch(`../schedules/${empId}.json`);

        if (!response.ok) throw new Error('Not found');

        const data = await response.json();
        currentData = data;

        availableMonths = Object.keys(data.schedules).sort().reverse();
        if (availableMonths.length === 0) throw new Error('No schedules');

        currentMonth = availableMonths[0];
        renderSchedule();

      } catch (error) {
        contentArea.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">âŒ</div>
            <h3>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª</h3>
            <p>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ ${empId} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
            <p style="margin-top:10px;font-size:13px;color:#94a3b8;font-weight:700;">ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ù‚Ù… ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
          </div>
        `;
      }
    }

    // Render schedule
    function renderSchedule() {
      const schedule = currentData.schedules[currentMonth];
      const [year, month] = currentMonth.split('-').map(Number);

      const monthNames = [
        'ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ',
        'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'
      ];
      const monthName = monthNames[month - 1];

      const currentMonthIndex = availableMonths.indexOf(currentMonth);
      const hasNext = currentMonthIndex > 0;
      const hasPrev = currentMonthIndex < availableMonths.length - 1;

      // Build calendar
      const firstDay = new Date(year, month - 1, 1);
      const lastDay = new Date(year, month, 0);
      const startDayOfWeek = (firstDay.getDay() + 1) % 7; // Adjust for Sunday = 0
      const daysInMonth = lastDay.getDate();

      let calendarHTML = '';
      let dayCounter = 1;

      for (let week = 0; week < 6; week++) {
        for (let day = 0; day < 7; day++) {
          if ((week === 0 && day < startDayOfWeek) || dayCounter > daysInMonth) {
            calendarHTML += '<div class="calendar-day empty"></div>';
          } else {
            const dayData = schedule.find(s => s.day === dayCounter);
            const isToday = isCurrentDay(year, month, dayCounter);

            if (dayData) {
              const shiftClass = getShiftClass(dayData.shift_group);
              calendarHTML += `
                <div class="calendar-day ${isToday ? 'today' : ''}">
                  <div class="day-number">${dayCounter}</div>
                  <div class="day-shift">${getShiftIcon(dayData.shift_group)}</div>
                  <div class="day-label ${shiftClass}">${getShiftName(dayData.shift_group)}</div>
                  <div class="day-code">${dayData.shift_code || ''}</div>
                </div>
              `;
            } else {
              calendarHTML += `
                <div class="calendar-day ${isToday ? 'today' : ''}">
                  <div class="day-number">${dayCounter}</div>
                  <div class="day-shift">-</div>
                  <div class="day-label shift-other">-</div>
                </div>
              `;
            }
            dayCounter++;
          }
        }
        if (dayCounter > daysInMonth) break;
      }

      const stats = calculateStatistics(schedule);

      document.getElementById('contentArea').innerHTML = `
        <div class="employee-info">
          <div class="employee-details">
            <h2>${escapeHtml(currentData.name)}</h2>
            <p>ğŸ“‹ ${escapeHtml(currentData.department)} â€¢ ğŸ†” ${escapeHtml(currentData.id)}</p>
          </div>

          <div class="month-nav">
            <button onclick="changeMonth(-1)" ${!hasPrev ? 'disabled style="opacity:0.35;cursor:not-allowed"' : ''}>â†’</button>
            <span>${monthName} ${year}</span>
            <button onclick="changeMonth(1)" ${!hasNext ? 'disabled style="opacity:0.35;cursor:not-allowed"' : ''}>â†</button>
          </div>
        </div>

        <div class="calendar">
          <div class="calendar-header">
            <div>Ø§Ù„Ø³Ø¨Øª</div><div>Ø§Ù„Ø¬Ù…Ø¹Ø©</div><div>Ø§Ù„Ø®Ù…ÙŠØ³</div><div>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</div><div>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</div><div>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</div><div>Ø§Ù„Ø£Ø­Ø¯</div>
          </div>
          <div class="calendar-body">
            ${calendarHTML}
          </div>
        </div>

        <div class="statistics">
          <h3>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
          <div class="stats-grid">
            <div class="stat-card"><div class="stat-label">Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„</div><div class="stat-value">${stats.workDays}</div></div>
            <div class="stat-card"><div class="stat-label">Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</div><div class="stat-value">${stats.offDays}</div></div>
            <div class="stat-card"><div class="stat-label">Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ©</div><div class="stat-value">${stats.morning}</div></div>
            <div class="stat-card"><div class="stat-label">Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ©</div><div class="stat-value">${stats.afternoon}</div></div>
            <div class="stat-card"><div class="stat-label">Ø§Ù„Ù„ÙŠÙ„ÙŠØ©</div><div class="stat-value">${stats.night}</div></div>
            <div class="stat-card"><div class="stat-label">Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ©</div><div class="stat-value">${stats.leaves}</div></div>
          </div>
        </div>

        <div class="actions">
          <button class="action-btn action-btn-primary" onclick="downloadPDF()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ PDF</button>
          <button class="action-btn" onclick="shareSchedule()">ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
          <button class="action-btn" onclick="printSchedule()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
          <button class="action-btn" onclick="goBackToRoster()">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±ÙˆØ³ØªØ±</button>
        </div>
      `;
    }

    // Change month
    function changeMonth(direction) {
      const currentIndex = availableMonths.indexOf(currentMonth);
      const newIndex = currentIndex - direction;

      if (newIndex >= 0 && newIndex < availableMonths.length) {
        currentMonth = availableMonths[newIndex];
        renderSchedule();
      }
    }

    function getShiftIcon(group) {
      const icons = {
        'Morning': 'â˜€ï¸',
        'Afternoon': 'ğŸŒ¤ï¸',
        'Night': 'ğŸŒ™',
        'Off Day': 'ğŸ›Œ',
        'Annual Leave': 'âœˆï¸',
        'Sick Leave': 'ğŸ¤’',
        'Training': 'ğŸ“š',
        'Standby': 'ğŸ§',
        'Other': 'â“'
      };
      return icons[group] || 'â“';
    }

    function getShiftName(group) {
      const names = {
        'Morning': 'ØµØ¨Ø§Ø­ÙŠØ©',
        'Afternoon': 'Ù…Ø³Ø§Ø¦ÙŠØ©',
        'Night': 'Ù„ÙŠÙ„ÙŠØ©',
        'Off Day': 'Ø¥Ø¬Ø§Ø²Ø©',
        'Annual Leave': 'Ø¥Ø¬Ø§Ø²Ø© Ø³Ù†ÙˆÙŠØ©',
        'Sick Leave': 'Ø¥Ø¬Ø§Ø²Ø© Ù…Ø±Ø¶ÙŠØ©',
        'Training': 'ØªØ¯Ø±ÙŠØ¨',
        'Standby': 'Ø§Ø­ØªÙŠØ§Ø·ÙŠ',
        'Other': 'Ø£Ø®Ø±Ù‰'
      };
      return names[group] || 'Ø£Ø®Ø±Ù‰';
    }

    function getShiftClass(group) {
      const classes = {
        'Morning': 'shift-morning',
        'Afternoon': 'shift-afternoon',
        'Night': 'shift-night',
        'Off Day': 'shift-off',
        'Annual Leave': 'shift-leave',
        'Sick Leave': 'shift-leave',
        'Training': 'shift-training',
        'Standby': 'shift-standby',
        'Other': 'shift-other'
      };
      return classes[group] || 'shift-other';
    }

    function isCurrentDay(year, month, day) {
      const today = new Date();
      return today.getFullYear() === year &&
             today.getMonth() + 1 === month &&
             today.getDate() === day;
    }

    function calculateStatistics(schedule) {
      const stats = { workDays:0, offDays:0, morning:0, afternoon:0, night:0, leaves:0 };

      schedule.forEach(day => {
        if (day.shift_group === 'Morning') stats.morning++;
        else if (day.shift_group === 'Afternoon') stats.afternoon++;
        else if (day.shift_group === 'Night') stats.night++;
        else if (day.shift_group === 'Off Day') stats.offDays++;
        else if (day.shift_group === 'Annual Leave' || day.shift_group === 'Sick Leave') stats.leaves++;
      });

      stats.workDays = stats.morning + stats.afternoon + stats.night;
      return stats;
    }

    // Safe text
    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // Action functions (placeholders)
    function downloadPDF() { alert('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒÙ€ PDF'); }

    function shareSchedule() {
      const empId = currentData.id;
      const base = location.pathname.includes("/roster-site/") ? "/roster-site/" : "/";
      const url = `${window.location.origin}${base}my-schedule/?emp=${encodeURIComponent(empId)}`;

      if (navigator.share) {
        navigator.share({
          title: 'Ø¬Ø¯ÙˆÙ„ÙŠ - Duty Roster',
          text: `Ø¬Ø¯ÙˆÙ„ Ù…Ù†Ø§ÙˆØ¨Ø§Øª ${currentData.name}`,
          url
        });
      } else {
        navigator.clipboard.writeText(url);
        alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·! ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ø±ÙƒØªÙ‡ Ø§Ù„Ø¢Ù†');
      }
    }

    function printSchedule() { window.print(); }

    // Auto-load if emp parameter exists
    const urlParams = new URLSearchParams(window.location.search);
    const empParam = urlParams.get('emp');
    if (empParam) {
      document.getElementById('employeeId').value = empParam;
      loadEmployeeSchedule(empParam);
    }
  </script>
</body>
</html>
